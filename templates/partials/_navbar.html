{# templates/partials/navbar.html #}
<nav class="site-nav" aria-label="Navigation principale">
  <!-- Colonne gauche : logo / marque -->
  <div class="nav-left">
    <a href="{% url 'core:home' %}" class="brand">
      {{ COMPANY_NAME|default:"BamyTest" }}
    </a>
  </div>

  <!-- Menu burger (mobile) -->
  <button id="nav-toggle" class="nav-burger" aria-label="Menu" aria-expanded="false" aria-controls="nav-menu">
    <span class="burger-bar"></span>
    <span class="burger-bar"></span>
    <span class="burger-bar"></span>
  </button>

  <!-- Liens principaux -->
  <ul id="nav-menu" class="nav-menu">
    <li><a class="nav-link flex items-center gap-1" href="{% url 'core:home' %}"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7"/><path d="M9 22V12H15V22"/></svg><span>Accueil</span></a></li>
    <!-- Menu Catalogue avec sous-catégories -->
    <li class="relative group">
      <a class="nav-link flex items-center gap-1" href="{% url 'catalog:product_list' %}"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span>Catalogue</span></a>
      {% if nav_categories %}
      <div class="absolute left-0 mt-2 w-56 bg-white rounded-xl shadow-lg ring-1 ring-black/5 hidden group-hover:block z-50">
        <ul class="py-2">
          {% for cat in nav_categories %}
            <li>
              <a href="{{ cat.get_absolute_url }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{ cat.name }}</a>
            </li>
          {% endfor %}
          <li><hr class="my-1 border-t" /></li>
          <li>
            <a href="{% url 'catalog:product_list' %}" class="block px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-100">Toutes les catégories</a>
          </li>
        </ul>
      </div>
      {% endif %}
    </li>
    <li><a class="nav-link flex items-center gap-1" href="{% url 'core:about' %}"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg><span>À propos</span></a></li>
    <li><a class="nav-link flex items-center gap-1" href="{% url 'core:contact' %}"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="18" height="14" rx="2" ry="2"/><polyline points="3,5 12,13 21,5"/></svg><span>Contact</span></a></li>
    <li><a class="nav-link flex items-center gap-1" href="{% url 'catalog:week_selection' %}"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12h18M3 6h18M3 18h18" /></svg><span>Sélection semaine</span></a></li>
  </ul>

  <!-- Colonne droite : actions -->
  <div class="nav-right">
    <!-- Barre de recherche (desktop) -->
    <form action="{% url 'catalog:product_list' %}" method="get" class="hidden lg:block mr-4">
      <label for="nav-search" class="sr-only">Rechercher</label>
      <input id="nav-search" name="query" type="search" placeholder="Rechercher..."
             class="px-3 py-2 w-64 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-brand-primary text-sm" />
    </form>
    <!-- Wishlist -->
    <div class="nav-action" id="nav-wishlist">
      <button type="button" class="icon-btn" aria-label="Wishlist">
        <!-- Icône cœur moderne -->
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 21l7.8-7.6 1-1a5.5 5.5 0 0 0 0-7.8z"/>
        </svg>
        <span id="wishlist-badge" class="badge" style="display:none;">0</span>
      </button>
      <div class="panel" id="wishlist-panel" style="display:none">
        <p class="panel-title">Favoris : <span id="wishlist-count">0</span></p>
        <a href="{% url 'catalog:wishlist' %}" class="panel-link" id="wishlist-open">Voir mes favoris</a>
      </div>
    </div>

    <!-- Panier -->
    <div class="nav-action" id="nav-cart">
      <a href="{% url 'cart:detail' %}" class="icon-btn" aria-label="Panier">
        <!-- Icône panier moderne -->
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <span class="badge">{{ cart_count|default:0 }}</span>
      </a>
      <div class="panel" id="cart-panel" style="display:none">
        <p class="panel-title">Panier : <strong>{{ cart_count|default:0 }}</strong> article(s)</p>
        <p class="panel-sub">Total : <strong>{{ cart_total|default:"0.00" }} €</strong></p>
        <div class="panel-actions">
          <!-- Bouton ghost : accéder au panier complet -->
          <a href="{% url 'cart:detail' %}" class="btn ghost">Voir panier</a>
          <!-- Bouton primaire : accéder au paiement directement -->
          <a href="{% url 'orders:checkout' %}" class="btn primary">Payer</a>
        </div>
      </div>
    </div>

    <!-- Auth -->
    {% if request.user.is_authenticated %}
      <span class="nav-hello">Bonjour, {{ request.user.username }}</span>

      <!-- Lien vers mon compte -->
      <a href="{% url 'userauths:account' %}" class="icon-btn" aria-label="Mon compte">
        <!-- Icône profil moderne -->
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M4 21v-2a4 4 0 0 1 3-3.87"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
      </a>

      <!-- Logout en POST -->
      <form method="post" action="{% url 'userauths:logout' %}" class="nav-logout-form">
        {% csrf_token %}
        <button type="submit" class="icon-btn" aria-label="Se déconnecter">
          <!-- Icône logout moderne -->
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
        </button>
      </form>
    {% else %}
      <a class="icon-btn" href="{% url 'userauths:login' %}" aria-label="Se connecter">
        <!-- Icône login moderne -->
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
          <polyline points="10 17 15 12 10 7"/>
          <line x1="15" y1="12" x2="3" y2="12"/>
        </svg>
      </a>
      <a class="nav-link" href="{% url 'userauths:register' %}">Créer un compte</a>
    {% endif %}

  </div>
</nav>
